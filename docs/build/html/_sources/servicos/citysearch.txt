Pesquisa de Cidades
===================

.. include:: ../times/portalpadroes.rst

O serviço de pesquisa de cidades permite buscar uma lista de cidades do Brasil (e de algumas capitais do mundo). A lista de cidades é filtrada a partir do começo do nome da cidade.

Instalação
----------

Para utilizar esta funcionalidade do libby, é necessária a inclusão do script do globo-api na sua
página, conforme abaixo.

.. code-block:: html

    <script type="text/javascript"
            src="http://api.globo.com/js/globo-api-latest-min.js">
    </script>

Utilização
==========

Para utilizar o serviço de busca de cidade, basta invocar a função search conforme abaixo,
informando o callback que deseja ser executado quando houver resposta:

.. code-block:: html

    <script type="text/javascript">
        globoapi.citySearch.search('termo de busca', function(results, term){
            // [ {
            //      "city": "São Paulo",
            //      "state": "SP",
            //      "translated_city": "sao paulo",
            //      "slug": "sp/sao-paulo"
            // } ]
        });
    </script>

.. warning::
    
    Se o termo informado for menor que 3 caracteres o serviço retorna status 404. A aplicação deve tratar esse caso e não
    fazer nenhuma chamada com termos menores que 3.

.. warning::
    
    No caso de múltiplas chamadas sucessivas, o serviço de busca de cidades não
    garante a ordem de chamada do callback. Uma alternativa para garantir que somente a
    última requisição seja utilizada é verificar o termo no retorno do callback.

.. info::

    Por se tratar de um serviço que requer configurações e que precisa ser
    incluído na posição certa da página, o libby não possui app para este
    serviço.

    Ao invés disso, basta a inclusão dos scripts necessários conforme acima.
    O script do serviço é minificado utilizando o closure compiler do google,
    o que o torna **BEM** pequeno.

Endereços dos Scripts
---------------------

Os endereços para utilização do serviço de pesquisa de cidades são:

* Dev - http://api.dev.globoi.com/citysearch
* QA01 - http://api.qa01.globoi.com/citysearch
* Prod - http://api.globo.com/citysearch

Endereços dos scripts do globo-api (requerimento para uso do serviço):

* Dev - http://api.dev.globoi.com/js/globo-api-<versao>-min.js
* QA01 - http://api.qa01.globoi.com/js/globo-api-<versao>-min.js
* Prod - http://api.globo.com/js/globo-api-<versao>-min.js

<versao> corresponde a versão do globo-api que você deseja utilizar. Utilize
"latest" para a última versão estável.

Exemplos: http://api.globo.com/js/globo-api-latest-min.js,
http://api.globo.com/js/globo-api-0.6.0-min.js, etc.

Utilização sem o SDK
--------------------

Apesar de os scripts do globo-api facilitarem o uso do serviço de
pesquisa de cidades, a utilização do mesmo por HTTP GET é suportada, conforme
demonstrado no script abaixo, utilizando JQuery:

.. code-block:: html

    <script type="text/javascript">
        $.ajax({
            dataType: 'jsonp',
            jsonpCallback: 'globoapi_citySearch_callback',
            jsonp: false,
            url: 'http://api.globo.com/citysearch/rio',
            success: function(term, results){
                // Do something with results
            }
        });
    </script>
